<script type="text/javascript">    
$(function(){  
  $('.tag-name').click(function(){    
    var tag_id = $(this).attr('data-tag-id');
    var image_id = $(this).parent().parent().siblings('.img').attr('data-image-id');
    var ori_tag_name = $(this).html();
    if(!$(this).is('.input')){    
      $(this).addClass('input').html('<input type="text" value="'+ $(this).text() +'" />').find('input').focus().blur(function(){    
        var tag_name = $(this).val();
        var csrf_token = $('meta[name=csrf-token]').attr('content');
        var this_element= $(this).parent();
        $.ajax({
          type: 'PATCH',
          url: '/images/'+image_id,
          data: {authenticity_token: csrf_token, tag_name: tag_name},
          success: function(data){
            if(data.code==0){
              window.location.reload();
            }else{
              this_element.removeClass('input').html(ori_tag_name);
            }
            $('#toast p').html(data.msg);
            $("#toast").show();
            $("#toast").fadeOut(4000);
          },
          error: function(){
            this_element.removeClass('input').html(ori_tag_name);
            $('#toast p').html("修改tag失败");
            $("#toast").show();
            $("#toast").fadeOut(4000);
          }
        });
      });
    }
  }).hover(function(){
    $(this).addClass('hover');
  },function(){
    $(this).removeClass('hover');
  });
});
</script>
